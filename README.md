# Building a SOC + Honeynet in Azure (Live Traffic)
![image](https://github.com/user-attachments/assets/29175f10-3b6b-462d-befb-83054faaf316)



In this project, I created a mini honeynet in Azure and configured it to collect log data from various sources into a Log Analytics workspace. This data was then utilized by Microsoft Sentinel to generate attack maps, trigger alerts, and create security incidents. Initially, I measured specific security metrics in an unprotected environment over a 24-hour period. After applying security controls to secure the environment, I measured the metrics again for another 24 hours. The metrics being analyzed include:

SecurityEvent (Windows Event Logs)
Syslog (Linux Event Logs)
SecurityAlert (Alerts triggered in Log Analytics)
SecurityIncident (Incidents generated by Sentinel)
AzureNetworkAnalytics_CL (Malicious traffic flows into the honeynet)

## Architecture Before Hardening / Security Controls
![Architecture Diagram](https://i.imgur.com/aBDwnKb.jpg)

## Architecture After Hardening / Security Controls
![Architecture Diagram](https://i.imgur.com/YQNa9Pp.jpg)

The architecture of the mini honeynet in Azure is built using the following components:

Virtual Network (VNet): Provides a secure networking foundation.
Network Security Group (NSG): Controls inbound and outbound traffic to resources.
Virtual Machines: Includes two Windows and one Linux VM serving as honeypots.
Log Analytics Workspace: Collects and analyzes log data.
Azure Key Vault: Safeguards sensitive information such as keys and secrets.
Azure Storage Account: Stores data related to the honeynet environment.
Microsoft Sentinel: Monitors, analyzes, and responds to potential threats.
For the initial "BEFORE" setup, all resources were exposed to the internet. The Virtual Machines had their Network Security Groups and built-in firewalls configured with minimal restrictions, leaving them vulnerable. Other resources were deployed with public endpoints, without utilizing Private Endpoints.

In the "AFTER" setup, Network Security Groups were strengthened by blocking all traffic except from the admin workstation. Built-in firewalls were enabled for added protection, and Private Endpoints were used to secure access to other resources.


## Attack Maps Before Hardening / Security Controls
![NSG Allowed Inbound Malicious Flows](https://i.imgur.com/1qvswSX.png)<br>
![Linux Syslog Auth Failures](https://i.imgur.com/G1YgZt6.png)<br>
![Windows RDP/SMB Auth Failures](https://i.imgur.com/ESr9Dlv.png)<br>

## Metrics Before Hardening / Security Controls

The following table shows the metrics i measured in insecure environment for 24 hours:
Start Time 2023-03-15 17:04:29
Stop Time 2023-03-16 17:04:29

| Metric                   | Count
| ------------------------ | -----
| SecurityEvent            | 19470
| Syslog                   | 3028
| SecurityAlert            | 10
| SecurityIncident         | 348
| AzureNetworkAnalytics_CL | 843

## Attack Maps Before Hardening / Security Controls

```All map queries actually returned no results due to no instances of malicious activity for the 24 hour period after hardening.```

## Metrics After Hardening / Security Controls

The following table shows the metrics i measured in my environment for another 24 hours, but after i have applied security controls:
Start Time 2023-03-18 15:37
Stop Time	2023-03-19 15:37

| Metric                   | Count
| ------------------------ | -----
| SecurityEvent            | 8778
| Syslog                   | 25
| SecurityAlert            | 0
| SecurityIncident         | 0
| AzureNetworkAnalytics_CL | 0

## Conclusion
In this project, a mini honeynet was set up in Microsoft Azure, with log sources integrated into a Log Analytics workspace. Microsoft Sentinel was used to generate alerts and incidents based on the collected logs. Security metrics were recorded in an unsecured environment before applying security controls and then measured again after implementing these controls. The results showed a significant reduction in security events and incidents, highlighting the effectiveness of the applied measures.

Itâ€™s worth mentioning that if the network resources had been heavily accessed by regular users, there might have been an increase in security events and alerts during the 24-hour period after the controls were put in place.
